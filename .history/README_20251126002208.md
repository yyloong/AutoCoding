# DeepResearch 部分功能更新介绍

## 1. 在 research 阶段添加了 GitHub Research 工具

我添加了[github_search.py](ms_agent/tools/github_search.py)文件，用于GitHub代码搜索功能，可以搜索GitHub上的开源代码并获取文件内容用于分析和学习。

### 功能特性

1. **GitHub代码搜索**：可以根据关键词、语言等条件搜索GitHub上的代码
2. **文件内容获取**：可以获取指定GitHub仓库中文件的内容
3. **结果排序**：支持按star数、fork数或更新时间排序搜索结果

### 运行前准备（Windows系统）

在使用GitHub Research功能之前，需要获取GitHub API Token并设置环境变量：

#### 1. 获取GitHub Personal Access Token

1. 登录GitHub账户
2. 点击右上角头像，选择"Settings"
3. 在左侧菜单中选择"Developer settings"
4. 选择"Personal access tokens" → "Tokens (classic)"
5. 点击"Generate new token" → "Generate new token (classic)"
7. 选择适当的权限（至少需要`public_repo`权限）
8. 点击"Generate token"
9. 复制生成的token

#### 2. 设置环境变量

**在cmd中设置：**
```cmd
setx GITHUB_TOKEN "your_token_here"
```

**在PowerShell中设置：**
```powershell
[Environment]::SetEnvironmentVariable("GITHUB_TOKEN", "your_token_here", "User")
```

#### 3. 验证Token设置

命令行中运行以下命令验证Token是否设置成功：
```cmd
echo %GITHUB_TOKEN%
```
（在PowerShell中使用 `echo $env:GITHUB_TOKEN`）

### 补充说明

上述设置后，deepcodingresearch过程中即可使用GitHub Research功能。但获取文件内容时会消耗大量token，不知道有没有方法能解决。

## 2. 在 research 阶段将 DeepResearch 作为工具传给 agent

DeepResearch的大致流程为：

1. **工具注册**：DeepResearch工具通过ToolBase接口注册到agent工具系统中，提供run_research方法供agent调用。

2. **参数配置**：agent可以指定研究的深度(depth)、广度(breadth)、是否使用Ray并行处理(use_ray)（Ray有点问题）等参数。

3. **工作流初始化**：当agent调用DeepResearch时，系统会初始化ResearchWorkflowBeta工作流，配置LLM客户端、搜索引擎和输出目录。

4. **递归搜索执行**：ResearchWorkflowBeta执行深度研究，包括：
   - 根据研究主题生成搜索查询
   - 递归执行多轮搜索以获取更深入的信息
   - 使用并发控制机制管理搜索和LLM调用

5. **信息提取与整合**：从搜索结果中提取关键信息，生成结构化的研究学习内容。

6. **报告生成**：将研究结果整合成Markdown格式的报告，包含文本内容和多媒体元素（如图片、表格）。

7. **结果返回**：研究完成后，将结果保存到output\deep_research_output，后续agent会读取report.md文件内容。

### DeepResearch共支持三种搜索方式

1. **Exa搜索**：一种通用的网络搜索引擎，支持关键词和神经搜索模式，适合广泛的主题研究。
2. **SerpApi搜索**：基于Google搜索引擎的API，提供高质量的搜索结果，适合需要精确答案的研究。
3. **Arxiv搜索**：专门针对学术论文的搜索引擎，默认使用此方式，适合科学研究和技术文档的检索。

### 当前选择

目前默认使用**Arxiv搜索**方式，无需API密钥。如果添加其他方式还需自行在projects\deep_research\conf.yaml中配置，并提供API。

### 运行
## 3. 验证 DeepResearch 功能

我实现的 DeepResearch 的接口会读取OPENAI_API_KEY和OPENAI_BASE_URL环境变量，若之前设置了可忽略。

可以通过以下命令验证DeepResearch功能是否能被正常调用：

```bash
python -m ms_agent.cli.cli run --config projects/deepcodingresearch --query "通过调用deep_research---run_research，调研一下大语言模型在代码生成领域的最新进展，并总结出三个关键技术点。" --trust_remote_code true
```

若在output\deep_research_output目录下能找到生成的report.md文件，说明DeepResearch功能正常。

### 补充说明

因为现在只实现了Arxiv搜索，所以获得的信息都是很学术的，很难说对于编程任务有多少帮助。